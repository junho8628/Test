<!doctype html>
<html>
	<head>
		<title>list sitemap</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<style>
			body{
				margin: 40px auto;
				width: 650px;
				/* background-image: url("../static/img/zio.png"); */
				background-repeat: no-repeat;
				/*background-size: cover;*/
			}
			/* -------------------------------------- */
			ol{
				counter-reset: li;
				list-style: none;
				*list-style: decimal;
				font: 15px 'trebuchet MS', 'lucida sans';
				padding: 0;
				margin-bottom: 4em;
				text-shadow: 0 1px 0 rgba(255,255,255,.5);
			}

			ol ol{
				margin: 0 0 0 2em;		
			}
			/* -------------------------------------- */		
			.rounded-list a{
				position: relative;
				display: block;
				padding: .4em .4em .4em 2em;
				*padding: .4em;
				margin: .5em 0;
				background:#bdbebd;
				color: black;
				text-decoration: none;
				-moz-border-radius: .3em;
				-webkit-border-radius: .3em;
				border-radius: .3em;
				-webkit-transition: all .3s ease-out;
				-moz-transition: all .3s ease-out;
				-ms-transition: all .3s ease-out;
				-o-transition: all .3s ease-out;
				transition: all .3s ease-out;	
			}
			.rounded-list a:hover{background: #eee;}
			.rounded-list a:hover:before{
				-moz-transform: rotate(360deg);
			  	-webkit-transform: rotate(360deg);
			    -moz-transform: rotate(360deg);
			    -ms-transform: rotate(360deg);
			    -o-transform: rotate(360deg);
			    transform: rotate(360deg);	
			}
			.rounded-list a:before{
				content: counter(li);
				counter-increment: li;
				position: absolute;	
				left: -1.3em;
				top: 50%;
				margin-top: -1.3em;
				background: #87ceeb;
				height: 2em;
				width: 2em;
				line-height: 2em;
				border: .3em solid #fff;
				text-align: center;
				font-weight: bold;
				-moz-border-radius: 2em;
				-webkit-border-radius: 2em;
				border-radius: 2em;
				-webkit-transition: all .3s ease-out;
				-moz-transition: all .3s ease-out;
				-ms-transition: all .3s ease-out;
				-o-transition: all .3s ease-out;
				transition: all .3s ease-out;
			}
			h1{
				color: #87ceeb;
				font-weight: bold;
			}
			.submenu{
				position:relative;
				width:100%;
				height:100%;
				z-index: 1;
			}
			.submenu li>a{background :#D3D3D3;}
			.submenu2{
				position:relative;
				width:100%;
				height:100%;
				z-index: 1;
				}
			.submenu2 li>a{background:#e9e9e9;}
			span {color:black}

			/* modal */
			#modal {position: fixed; left:0; top:0; width: 100%; height: 100%; transform: scale(0); z-index: 1;}
			#modal .modal-bg {background: rgba(0,0,0,0.7); display:flex; align-items: center; justify-content: center; height: 100%; }
			#modal .modal-bg .modal-cont {position:relative; background: #fff; padding: 40px; max-width: 500px; display: inline-block;}
			#modal .modal-bg .modal-cont h2 {font-size: 30px; margin:0;}
			#modal .modal-bg .modal-cont p {font-size: 18px; }
			#modal .modal-bg .modal-cont .close {position: absolute; top: 0; right:0; margin:10px; padding: 10px; background: #87ceeb; border-radius: 50%; }
			#modal .modal-bg .modal-cont .close:hover{background-color: blue;}
			#modal .modal-bg .modal-cont .close svg {width: 24px; fill: #fff; vertical-align: top;}


			#modal.one {
				transform: scaleY(0.01) scaleX(0);
				animation: unfoldIn 1s cubic-bezier(0.165, 0.85, 0.44, 1) forwards;
			}
			#modal.one .modal-bg .modal-cont {
				transform: scale(0);
				animation: zoomIn 0.5s 0.8s cubic-bezier(0.165, 0.85, 0.44, 1) forwards;
			}

			#modal.one.out {
				transform: scale(1);
				animation: unfoldOut 1s cubic-bezier(0.165, 0.85, 0.44, 1) forwards;
			}
			#modal.one.out .modal-bg .modal-cont {
				transform: scale(0);
				animation: zoomOut 0.5s cubic-bezier(0.165, 0.85, 0.44, 1) forwards;
			}

			@keyframes unfoldIn{
				0% {transform: scaleY(0.005) scaleX(0);}
				50% {transform: scaleY(0.005) scaleX(1);}
				100% {transform: scaleY(1) scaleX(1);}
			}
			@keyframes unfoldOut{
				0% {transform: scaleY(1) scaleX(1);}
				50% {transform: scaleY(0.005) scaleX(1);}
				100% {transform: scaleY(0.005) scaleX(0);}
			}
			@keyframes zoomIn {
				0% {transform: scale(0);}
				100% {transform: scale(1); }
			}
			@keyframes zoomOut {
				0% {transform: scale(1);}
				100% {transform: scale(0); }
			}

			
			@media (min-width:360px) and (max-width: 780px){
				body{
					background-image: none;
					width:auto;
				}
				.rounded-list{
					float: none;
					width: auto;
					padding: 20px;
				}
				.submenu{right:23px;}
				.submenu2{right:20px;}
				#title{
					text-align: center;
				}
			}
			.btn {
				display: inline-block;
				border-radius:10px 10px 10px 10px;
				border : 1px solid skyblue;
				background-color:#eee;
				color:black;
				padding:5px;
				margin-left:3px;
				cursor :pointer;
			}
			.gobtn {
				display: inline-block;
				border-radius:10px 10px 10px 10px;
				border : 1px solid skyblue;
				background-color:#eee;
				color:black;
				padding:5px;
				margin-left:3px;
				cursor :pointer;
			}
			.btn:hover{
				background-color:white;
			}
			.gobtn:hover{
				background-color:white;
			}
			input:focus {outline:none;}
		</style>

		<script src="../static/js/jquery-3.5.1.min.js"></script>
		<script>
			$(function(){
				gourl();
				open();
				$('.rounded-list>li').on('click',function(){ //2depth 출력
					var oneval = $(this).val();
					if($(this).attr("data-loaded")=='yes') {
						$.ajax({
							type:'POST',
							url:'http://127.0.0.1:5000/click',
							data : 
								{'pid' : oneval} ,
							dataType:'JSON',
							success:function(result){
								var obj = JSON.parse(JSON.stringify(result))
								for (i=0; i<Object.keys(obj).length; i++) {
									var a = document.createElement('li');
									a.setAttribute('value',obj[i].id);
									a.setAttribute('data-loaded','yes');
									a.innerHTML = "<a href=''>"+ obj[i].title +
									"<input class ='gobtn' type = 'button' name = 'urlbtn' value ='이동'><input class ='btn' type = 'button' name = 'describebtn' value ='설명'></a>"+
									"<ol class = 'submenu2' id = "+obj[i].id+"> </ol>";
									document.getElementById('onedepth_'+oneval).appendChild(a);
								}
								gourl();
							}
						});
						$(this).attr("data-loaded","no");
					}
					else if($(this).attr("data-loaded")=='no'){
						$(this).find('ol').empty();
						$(this).attr("data-loaded","yes");
					}
					return false; //event.preventDefault();  event.stopPropagation();
				});

				$('.submenu').on('click','li',function(){ //3depth 출력
					if($(this).attr("data-loaded")=='yes') {
						var twoval = $(this).val();
						$.ajax({
							type:'POST',
							url:'http://127.0.0.1:5000/click',
							data : 
								{'pid' : twoval} ,
							dataType:'JSON',
							success:function(result){
								var obj = JSON.parse(JSON.stringify(result))
								for (i=0; i<Object.keys(obj).length; i++) {
									var a = document.createElement('li');
									a.setAttribute('value',obj[i].id);
									a.innerHTML = "<a href=''>"+ obj[i].title +
									"<input class ='gobtn' type = 'button' name = 'urlbtn' value ='이동'><input class ='btn' type = 'button' name = 'describebtn' value ='설명'></a>";
									document.getElementById(twoval).appendChild(a);
								}
								gourl();
							}
						});
						$(this).attr("data-loaded","no");
					}else if($(this).attr("data-loaded")=='no'){
						$(this).find('ol').empty();
						$(this).attr("data-loaded","yes");
					}
					return false;
				});
				function gourl(){ //url 이동
					$('.gobtn').on('click',function(){
					var urlid = $(this).parent().parent().val();
						$.ajax({
							type:'POST',
							url:'http://127.0.0.1:5000/urlclick',
							data : 
								{'urlid' : urlid} ,
							dataType:'JSON',
							success:function(result){
								var basic_url = "https://dev.zioyou.com";
								window.open(basic_url+result['url'],'newpop');
							}
						});
						return false;
					});
				}
					$(".submenu").on('click','.btn',function(){
						var desid = $(this).parent().parent().val();
						// console.log(desid);
						// return false;
						$.ajax({
								type:'POST',
								url:'http://127.0.0.1:5000/desclick',
								data : 
									{'desid' : desid} ,
								dataType:'JSON',
								success:function(result){
									var a = document.getElementById('desc');
									a.innerHTML="<h3>"+result['title']+"</h3><p>"+result['describe']+"</p><a href='' class='close close1'>"+
										"<svg viewBox='0 0 24 24'>"+
										"<path d='M14.1,12L22,4.1c0.6-0.6,0.6-1.5,0-2.1c-0.6-0.6-1.5-0.6-2.1,0L12,9.9L4.1,2C3.5,1.4,2.5,1.4,2,2C1.4,2.5,1.4,3.5,2,4.1"+
										"L9.9,12L2,19.9c-0.6,0.6-0.6,1.5,0,2.1c0.3,0.3,0.7,0.4,1.1,0.4s0.8-0.1,1.1-0.4l7.9-7.9l7.9,7.9c0.3,0.3,0.7,0.4,1.1,0.4"+
										"s0.8-0.1,1.1-0.4c0.6-0.6,0.6-1.5,0-2.1L14.1,12z'/></svg></a>";
									$("#modal").removeAttr("class").addClass("one");
									dele();
								}
							});
						return false;
					});
					return false;
			
				function open(){
					$(".btn").on('click',function(){
						var desid = $(this).parent().parent().val();
						// console.log(desid);
						// return false;
						$.ajax({
								type:'POST',
								url:'http://127.0.0.1:5000/desclick',
								data : 
									{'desid' : desid} ,
								dataType:'JSON',
								success:function(result){
									var a = document.getElementById('desc');
									a.innerHTML="<h3>"+result['title']+"</h3><p>"+result['describe']+"</p><a href='' class='close close1'>"+
										"<svg viewBox='0 0 24 24'>"+
										"<path d='M14.1,12L22,4.1c0.6-0.6,0.6-1.5,0-2.1c-0.6-0.6-1.5-0.6-2.1,0L12,9.9L4.1,2C3.5,1.4,2.5,1.4,2,2C1.4,2.5,1.4,3.5,2,4.1"+
										"L9.9,12L2,19.9c-0.6,0.6-0.6,1.5,0,2.1c0.3,0.3,0.7,0.4,1.1,0.4s0.8-0.1,1.1-0.4l7.9-7.9l7.9,7.9c0.3,0.3,0.7,0.4,1.1,0.4"+
										"s0.8-0.1,1.1-0.4c0.6-0.6,0.6-1.5,0-2.1L14.1,12z'/></svg></a>";
									$("#modal").removeAttr("class").addClass("one");
									dele();
								}
							});
						return false;
					});
					return false;
				}

				function dele(){ // 팝업창 닫기
					$(".close").click(function(){
						$("#modal").addClass("out");
						return false;
					});
				}
			



			});
		</script>
	</head>
	<body>
		<h1 id="title">Group<span>Ware</span> SiteMap</h1>
				<ol class="rounded-list">
					{% for list in sitemap | sort(attribute='sortseq') %}
					{% if (list.depth) == 1 %}
					<li value = "{{list.id}}" data-loaded="yes"><a href="">{{list.title}}
						<input class ="gobtn" type = "button" name = "urlbtn" value ="이동">
						<input class ="btn" type = "button" name = "describebtn" value ="설명"></a>
						<ol class ='submenu' id = "onedepth_{{list.id}}"></ol>
					</li>
					{% endif %}
					{% endfor %}
				</ol>
				<!-- 팝업창시작 -->
				<div id="modal">
					<div class="modal-bg">
						<div class="modal-cont" id ="desc">	
							<a href="" class="close close1">
							</a>
						</div>
					</div>
				</div>
				<!-- 팝업창 종료 -->
	</body>
</html>